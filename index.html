<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDE - Geo Guessing Game</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Panorama JS -->
    <script type="text/javascript" src="https://api.mapy.cz/js/panorama/v1/panorama.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Start Screen -->
        <div id="startScreen">
            <div class="start-container">
                <h1>GDE SU?!</h1>
                <p class="subtitle">Geo Guessing Game</p>
                
                <div class="start-section">
                    <h2>Select Region</h2>
                    <div class="region-grid">
                        <button class="region-btn" data-region="czechia">
                            <span class="region-icon">üá®üáø</span>
                            <span class="region-name">Czech Republic</span>
                        </button>
                        <button class="region-btn" data-region="prague">
                            <span class="region-icon">‚≠ê</span>
                            <span class="region-name">Prague</span>
                        </button>
                        <button class="region-btn" data-region="brno">
                            <span class="region-icon">üöá</span>
                            <span class="region-name">Brno</span>
                        </button>
                        <button class="region-btn" data-region="moravia">
                            <span class="region-icon">üç∑</span>
                            <span class="region-name">Moravia</span>
                        </button>
                        <button class="region-btn" data-region="bohemia">
                            <span class="region-icon">üç∫</span>
                            <span class="region-name">Bohemia</span>
                        </button>
                        <button class="region-btn" id="drawRegionBtn">
                            <span class="region-icon">‚úèÔ∏è</span>
                            <span class="region-name">Draw Region</span>
                        </button>
                    </div>
                </div>
                
                <div class="start-section">
                    <h2>Select Game Mode</h2>
                    <div class="mode-grid">
                        <button class="mode-btn" data-mode="explorer">
                            <span class="mode-icon">üö∂</span>
                            <span class="mode-name">Explorer Mode</span>
                            <span class="mode-desc">Move around and explore the panorama</span>
                        </button>
                        <button class="mode-btn" data-mode="static">
                            <span class="mode-icon">üì∏</span>
                            <span class="mode-name">Static Mode</span>
                            <span class="mode-desc">Fixed view, no movement allowed</span>
                        </button>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button id="difficultyPrefsBtn" class="btn btn-secondary">‚öôÔ∏è Game Settings</button>
                    <button id="startGameBtn" class="btn btn-success" disabled>Start Game</button>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header style="display: none;">
            <h1>üåç GDE SU?! - Geo Guessing Game</h1>
            <div class="score-container">
                <div class="score-item">
                    <span class="label">Round:</span>
                    <span id="currentRound">1</span>/<span id="totalRounds">5</span>
                </div>
                <div class="score-item">
                    <span class="label">Total Score:</span>
                    <span id="totalScore">0</span>
                </div>
            </div>
        </header>

        <!-- Game Container -->
        <div id="gameContainer" style="display: none;">
            <!-- Fullscreen Panorama View -->
            <div id="panoramaSection">
                <div id="panoramaContainer"></div>
                <button id="resetLocationBtn" class="reset-location-btn" style="display: none;" title="Reset to Original Location">
                    üîÑ Reset Location
                </button>
            </div>

            <!-- Floating Map Overlay -->
            <div id="mapOverlay" class="collapsed">
                <div id="mapHeader">
                    <div class="map-title">
                        <span>üó∫Ô∏è Make your guess</span>
                    </div>
                    <div class="map-controls">
                        <select id="mapLayerSelect" title="Map Layer">
                            <option value="basic">Basic</option>
                            <option value="outdoor">Outdoor</option>
                            <option value="winter">Winter</option>
                            <option value="aerial">Aerial</option>
                        </select>
                        <button id="toggleMapSize" class="icon-btn" title="Expand/Collapse">
                            <span id="toggleIcon">‚õ∂</span>
                        </button>
                    </div>
                </div>
                <div id="mapContainer"></div>
                <div class="map-footer">
                    <button id="submitGuess" class="btn btn-primary btn-compact" disabled>Submit Guess</button>
                </div>
            </div>
        </div>

        <!-- Result Modal -->
        <div id="resultModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2 id="resultTitle">Round Result</h2>
                <div id="resultDetails">
                    <p><strong>Distance:</strong> <span id="resultDistance"></span></p>
                    <p><strong>Score:</strong> <span id="resultScore"></span></p>
                </div>
                <div id="resultMap"></div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button id="minimizeResult" class="btn btn-secondary">Minimize</button>
                    <button id="nextRound" class="btn btn-primary" style="display: none;">Next Round</button>
                </div>
            </div>
        </div>

        <!-- Restore Result Button (shown when minimized) -->
        <button id="restoreResult" class="restore-btn" style="display: none;">
            üìä Show Results
        </button>

        <!-- Game Settings Modal -->
        <div id="difficultyModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>‚öôÔ∏è Game Settings</h2>
                <p class="modal-subtitle">Customize your game settings</p>
                
                <div class="preferences-list">
                    <div class="preference-item">
                        <div class="preference-info">
                            <div class="preference-title">Switch Map Layers</div>
                            <div class="preference-desc">Allow changing map style in minimap</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="pref-mapLayers" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="preference-item">
                        <div class="preference-info">
                            <div class="preference-title">Show Play Region</div>
                            <div class="preference-desc">Display region boundaries on minimap</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="pref-showRegion" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="preference-item">
                        <div class="preference-info">
                            <div class="preference-title">Turn Around in Panorama</div>
                            <div class="preference-desc">Allow rotating view 360¬∞</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="pref-turnAround" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="preference-item">
                        <div class="preference-info">
                            <strong>Allow Zoom</strong>
                            <p>Enable zooming in the panorama view</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="pref-zoom" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="preference-item">
                        <div class="preference-info">
                            <strong>Score from Original Location (Explorer Mode)</strong>
                            <p>ON: starting point. OFF: current position</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="pref-targetOriginal" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button id="closeDifficultyModal" class="btn btn-primary">Done</button>
                </div>
            </div>
        </div>

        <!-- Draw Region Modal -->
        <div id="drawRegionModal" class="modal" style="display: none;">
            <div class="modal-content modal-large">
                <h2>‚úèÔ∏è Draw Your Custom Region</h2>
                <p class="modal-subtitle">Click and drag to draw the area where you want to play</p>
                <div class="draw-mode-toggle">
                    <button id="drawModeBtn" class="mode-toggle-btn active">
                        <span>‚úèÔ∏è</span> Draw
                    </button>
                    <button id="panModeBtn" class="mode-toggle-btn">
                        <span>ü§ö</span> Move Map
                    </button>
                </div>
                <div id="drawMapContainer"></div>
                <div class="draw-controls">
                    <button id="clearDrawing" class="btn btn-secondary">Clear Drawing</button>
                    <button id="confirmDrawing" class="btn btn-primary" disabled>Confirm Region</button>
                    <button id="cancelDrawing" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Final Score Modal -->
        <div id="finalScoreModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>üéâ Game Complete!</h2>
                <div id="finalScoreDetails">
                    <p class="final-score">Final Score: <span id="finalScore"></span></p>
                    <div id="roundBreakdown"></div>
                </div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button id="playAgain" class="btn btn-success">Play Again</button>
                    <button id="returnToMenu" class="btn btn-secondary">Return to Menu</button>
                </div>
            </div>
        </div>

        <!-- Panorama Error Modal -->
        <div id="panoramaErrorModal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <h2>‚ö†Ô∏è No Panorama Found</h2>
                <p>Could not find a panorama in the selected region after <span id="attemptCount">0</span> attempts.</p>
                <div id="debugMap" style="width: 100%; height: 400px; margin: 20px 0; border-radius: 8px;"></div>
                <p style="font-size: 0.9em; color: #666;">
                    üî¥ Red dots = attempts outside polygon<br>
                    üü¢ Green dots = attempts inside polygon (but no panorama found)
                </p>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                    <button id="retryPanorama" class="btn btn-success">Retry</button>
                    <button id="cancelPanorama" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
